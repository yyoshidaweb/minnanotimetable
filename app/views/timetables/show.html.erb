<% if @performances.present? %>
  <%# 日付選択タブ（イベントヘッダーの高さ分下げて配置する） %>
  <nav class="flex h-8 fixed top-12 z-160 w-full justify-around overflow-x-auto bg-white border-t border-gray-200">
    <% @days.each do |day| %>
      <%# 日付を MM/DD 形式でラベルに整形 %>
      <% label = day.date.strftime("%-m/%-d") %>
      <%# 現在選択中の日付かどうか判定 %>
      <% selected = (day.date == @selected_date) %>
      <%# 日付タブリンク。選択中の場合は下線を表示し、横幅は均等に伸ばす %>
      <%= link_to url_for(d: day.date),
            class: "flex-1 px-2 py-2 text-xs text-gray-800 font-bold border-b-4 #{selected ? 'border-gray-800' : 'border-transparent'} hover:border-gray-300 transition-colors duration-150 text-center whitespace-nowrap" do %>
        <%= label %>
      <% end %>
    <% end %>
  </nav>
  <%# タイムテーブル表示画面のメインコンテナ（画面全体の高さに設定する） %>
  <div class="h-svh flex flex-col overflow-hidden pb-[calc(3.5rem+env(safe-area-inset-bottom))]">
    <%# スクロールコンテナ（ヘッダーと日付選択タブの高さ分下げた位置に配置する） %>
    <div class="flex-1 pt-20 overflow-auto relative">
      <%# 横幅確保 %>
      <div class="min-w-max">
        <%# ヘッダー行 %>
        <div class="flex sticky top-0 z-110 bg-white">
          <%# 左上空白 %>
          <div class="sticky left-0 w-5 bg-white z-100"></div>
          <%# ステージヘッダー %>
          <% @stages.each do |stage| %>
            <div class="stage-header-col flex-1 min-w-30 z-95 border-b text-xs font-bold text-center p-2">
              <%= stage.stage_name_tag.name %>
            </div>
          <% end %>
        </div>
        <%# ボディ %>
        <div class="flex relative">
          <%# 時刻列（sticky left） %>
          <div class="w-5 sticky left-0 z-150 bg-white">
            <% time_slots_for_timetable(@performances).each do |hour| %>
              <p class="h-48 text-xs text-center pt-1 tabular-nums -translate-y-2.75">
                <%= hour %>
              </p>
            <% end %>
          </div>
          <%# ステージを展開 %>
          <% @stages.each do |stage| %>
            <div class="timetable-body-col flex-1 min-w-30 relative"
                style="height: <%= timetable_height_rem(@performances) %>rem;">
              <%# 各ステージの出演情報を検索 %>
              <% @performances_by_stage[stage.id].each do |performance| %>
                <%# 出演情報カード %>
                <%= link_to "#",
                class: "absolute left-1 right-1 bg-white rounded shadow p-1 text-xs",
                style: "
                  top: #{performance_top_rem(performance)}rem;
                  height: #{performance_height_rem(performance)}rem;" do %>
                  <% if performance.show_start_time? %>
                    <div class="text-[10px] text-gray-500">
                      <%= formatted_time(performance.start_time) %>
                    </div>
                  <% end %>
                  <% line_clamp = line_clamp_class_by_duration(performance.duration) %>
                  <p class="font-semibold text-xs leading-3 wrap-break-word <%= line_clamp %>">
                    <%= performance.performer.performer_name_tag.name %>
                  </p>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    <%# 下部タブメニュー %>
    <div
    class="flex flex-col items-center fixed bottom-0 left-0 w-full h-21 p-1
          bg-white border-t z-200
          pb-[env(safe-area-inset-bottom)]"
    >
      <small class="mb-1 text-xs text-gray-500 wrap-break-word">
        ※このタイムテーブルは非公式です。<br>
        必ず公式情報をご確認の上、ご利用ください。
      </small>
      <nav class="h-full w-full">
        <ul class="flex justify-around text-xs text-gray-800">
          <li class="flex flex-col items-center">
            <span class="material-symbols-outlined">table</span>
            <span>タイムテーブル</span>
          </li>
          <li class="flex flex-col items-center">
            <span class="material-symbols-outlined">artist</span>
            <span>出演者</span>
          </li>
          <li class="flex flex-col items-center">
            <span class="material-symbols-outlined">map</span>
            <span>ステージ</span>
          </li>
          <li class="flex flex-col items-center">
            <span class="material-symbols-outlined">info</span>
            <span>イベント詳細</span>
          </li>
        </ul>
      </nav>
    </div>
  </div>
<% else %>
  <%# 情報が揃った出演情報が0件の場合 %>
  <div class="text-center text-bold">
    <p>出演情報がありません</p>
  </div>
<% end %>