<% if @performances.present? %>
  <div class="overflow-x-auto">
    <table class="min-w-full border-collapse">
      <%# ===== ステージヘッダー ===== %>
      <thead class="sticky top-0 z-20">
        <tr>
          <th class="w-14 bg-white"></th>
          <% @stages.each do |stage| %>
            <th class="stage-col text-xs font-bold text-center">
              <div class="bg-stage py-2">
                <%= stage.display_name %>
              </div>
            </th>
          <% end %>
        </tr>
      </thead>
      <%# ===== テーブル本体 ===== %>
      <tbody>
        <% time_slots_for_timetable(@performances).each do |hour, minute| %>
          <tr class="h-16 relative">
            <%# 時刻列 %>
            <td class="time-cell sticky left-0 bg-white z-10 px-1">
              <% if minute == 0 %>
                <span class="text-xs text-gray-600">
                  <%= "%02d:00" % hour %>
                </span>
              <% end %>
            </td>
            <% @stages.each do |stage| %>
              <td class="stage-col relative align-top p-1 h-16">
                <% if perf = performance_at(@performances_by_stage, stage.id, hour, minute) %>
                  <% top_class = perf.start_m < 30 ? "top-1" : "top-1/2" %>
                  <div
                    class="absolute inset-x-1 <%= top_class %> h-1/2
                          bg-white rounded shadow text-xs p-1 overflow-hidden"
                  >
                    <div class="font-semibold leading-tight truncate">
                      <%= perf.performer.performer_name_tag.name %>
                    </div>
                  </div>
                <% end %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <p class="text-center mt-10">出演情報がありません</p>
<% end %>
