<% if @performances.present? %>
  <div class="overflow-x-auto">
    <table class="min-w-full border-collapse">
      <%# ===== ステージヘッダー ===== %>
      <thead class="sticky top-0 z-20">
        <tr>
          <th class="w-14 bg-white"></th>
          <% @stages.each do |stage| %>
            <th class="stage-col text-xs font-bold text-center">
              <div class="bg-stage py-2">
                <%= stage.display_name %>
              </div>
            </th>
          <% end %>
        </tr>
      </thead>
      <%# ===== テーブル本体 ===== %>
      <tbody>
        <% time_slots_for_timetable(@performances).each do |hour, minute| %>
          <tr class="h-16 relative">
            <%# 時刻列 %>
            <td class="time-cell sticky left-0 bg-white z-10 px-1">
              <% if minute == 0 %>
                <span class="text-xs text-gray-600">
                  <%= "%02d:00" % hour %>
                </span>
              <% end %>
            </td>
            <% @stages.each do |stage| %>
              <% perf = performance_at(@performances_by_stage, stage.id, hour, minute) %>
              <% if perf && performance_starting_at?(perf, hour, minute) %>
                <td class="stage-col p-1 align-top"
                    rowspan="<%= perf.slot_span %>">
                  <div class="bg-white rounded shadow text-xs p-1 h-full overflow-hidden">
                    <% if perf.duration >= 30 %>
                      <div class="text-[10px] text-gray-500">
                        <%= formatted_time(perf.start_time) %>
                      </div>
                    <% end %>
                    <div class="font-semibold leading-tight truncate">
                      <%= perf.performer.performer_name_tag.name %>
                    </div>
                  </div>
                </td>
              <% elsif perf %>
                <%# rowspan によってすでに使われているセルなので何も描画しない %>
              <% else %>
                <td class="stage-col h-16"></td>
              <% end %>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <p class="text-center mt-10">出演情報がありません</p>
<% end %>
